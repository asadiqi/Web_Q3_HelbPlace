{% extends "blog/base.html" %}

{% block content %}
<div class="container">
    <h2 class="mb-4 text-center">{{ canva.title }}</h2>

    <form method="POST" action="{% url 'update-canva' canva.id %}" id="update-form">
        {% csrf_token %}
        <div class="form-group">
            <label for="title">Title:</label>
            <input type="text" id="title" name="title" class="form-control" value="{{ canva.title }}" required>
        </div>
        <div class="form-group">
            <label for="timer">Timer (seconds):</label>
            <input type="number" id="timer" name="timer" class="form-control" value="{{ canva.timer }}" required>
        </div>

        <div class="canvas-grid">
            {% for row in pixels %}
                <div class="pixel-row">
                    {% for pixel in row %}
                        <div class="pixel" style="background-color: {{ pixel.color }};" 
                             data-x="{{ pixel.x }}" 
                             data-y="{{ pixel.y }}" 
                             onclick="selectPixel(event)">
                        </div>
                    {% empty %}
                        <p>No pixels available.</p>
                    {% endfor %}
                </div>
            {% endfor %}
        </div>

        <input type="hidden" name="pixel_data" id="pixel-data">
        <button type="submit" class="btn btn-primary mt-3">Update</button>
    </form>
</div>

<script>
    const pixelDataInput = document.getElementById('pixel-data');
    const pixels = document.querySelectorAll('.pixel');

    pixels.forEach(pixel => {
        pixel.addEventListener('click', () => {
            const x = pixel.dataset.x;
            const y = pixel.dataset.y;
            const color = prompt("Enter a color (Hex):", pixel.style.backgroundColor);
            if (color) {
                pixel.style.backgroundColor = color;
                // Collect pixel data
                const pixelData = JSON.parse(pixelDataInput.value || '[]');
                pixelData.push({x: parseInt(x), y: parseInt(y), color: color});
                pixelDataInput.value = JSON.stringify(pixelData);
            }
        });
    });
</script>
{% endblock %}

