{% extends "blog/base.html" %}

{% block content %}
<div class="container mt-5">
    <h1 class="text-center">HELBPlace Canva</h1>
    <p class="text-center">Bienvenue sur la page de HELBPlace Canva.</p>
</div>

<div class="container">
    <h2 class="mb-4 text-center">{{ canva.title }}</h2>

    <!-- Intégration du site collaboratif dans un iframe -->
    <div class="iframe-container">
        <iframe src="https://helbplace2425.alwaysdata.net/" width="100%" height="600px" frameborder="0"></iframe>
    </div>

    <!-- Formulaire pour modifier les pixels -->
    <div class="modify-grid mt-5">
        <form id="pixel-form" method="POST">
            {% csrf_token %}
            <div class="form-group">
                <label for="x">Column:</label>
                <input type="number" id="x" name="x" class="form-control" required>
            </div>
            <div class="form-group">
                <label for="y">Row:</label>
                <input type="number" id="y" name="y" class="form-control" required>
            </div>
            <div class="form-group">
                <label for="color">Color (Hex):</label>
                <input type="color" id="color" name="color" class="form-control" required>
            </div>

            <div id="countdown-timer" class="mt-3">
                <p id="countdown" class="text-danger"></p>
            </div>

            <button type="submit" class="btn btn-success mt-3">Save</button>
        </form>
    </div>
</div>

<style>
    .iframe-container {
        width: 100%;
        height: 600px;
        overflow: hidden;
        margin-top: 20px;
        border: 2px solid #000;
        border-radius: 10px;
        padding: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }

    #pixel-form {
        margin-top: 20px;
        padding: 20px;
        border: 1px solid #ddd;
        border-radius: 5px;
        background-color: #f9f9f9;
    }

    .form-group {
        margin-bottom: 15px;
    }

    .form-group label {
        font-weight: bold;
    }

    .form-control {
        width: 100%;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 4px;
    }

    .btn {
        width: 100%;
    }
</style>

<script>
    let lastModificationTime = 0;

    document.getElementById('pixel-form').addEventListener('submit', function(event) {
        event.preventDefault();
        const currentTime = Date.now();
        const timeSinceLastModification = currentTime - lastModificationTime;

        if (timeSinceLastModification < 11000) { // 11 secondes en millisecondes
            alert('Veuillez attendre 11 secondes avant de modifier un autre pixel.');
            return;
        }

        const x = document.getElementById('x').value;
        const y = document.getElementById('y').value;
        const color = document.getElementById('color').value.substring(1); // Remove the '#' from the color value

        const username = 'samir';
        const password = 'a5Vk6se1Aa6I';

        const url = `https://helbplace2425.alwaysdata.net/writer.php?username=${username}&password=${password}&row=${y}&col=${x}&hexvalue=${color}`;

        fetch(url)
            .then(response => {
                if (!response.ok) {
                    throw new Error('Erreur de réseau');
                }
                return response.text();
            })
            .then(data => {
                console.log('Réponse du serveur:', data);
                alert('Pixel modifié avec succès!');
                document.querySelector('iframe').src += '';
                lastModificationTime = Date.now(); // Mettre à jour le temps de la dernière modification
                startCountdown(11); // Démarrer le compte à rebours
            })
            .catch(error => {
                console.error('Erreur:', error);
            });
    });

    function startCountdown(seconds) {
        const countdownElement = document.getElementById('countdown');
        let remainingTime = seconds;

        const interval = setInterval(() => {
            countdownElement.textContent = `Veuillez attendre ${remainingTime} secondes avant de modifier un autre pixel.`;
            remainingTime--;

            if (remainingTime < 0) {
                clearInterval(interval);
                countdownElement.textContent = '';
            }
        }, 1000);
    }
</script>
{% endblock %}
